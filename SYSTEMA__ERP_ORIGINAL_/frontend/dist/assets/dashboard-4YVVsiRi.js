import{C as e,n as t}from"./utils-IgB7upkX.js";const a=new class{constructor(){this.cache=new Map,this.cacheTimeout=e.CACHE.DURATION,this.baseUrl="/api/dashboard"}async fetchData(a,o=!0){const r=a;if(o&&this.cache.has(r)){const e=this.cache.get(r);if(Date.now()-e.timestamp<this.cacheTimeout)return e.data}try{const t=await fetch(`${e.API_URL}/${a}`);if(!t.ok)throw new Error("Erro ao buscar dados");const s=await t.json();return o&&this.cache.set(r,{data:s,timestamp:Date.now()}),s}catch(s){return t.error("Erro ao carregar dados do dashboard"),console.error("Erro ao buscar dados:",s),null}}async getKPIs(){return await this.fetchData("dashboard/kpis")}async getVendasPorCategoria(e){return await this.fetchData(`dashboard/vendas/categoria?periodo=${e}`)}async getVendasPorPeriodo(e){return await this.fetchData(`dashboard/vendas/periodo?periodo=${e}`)}async getProdutosMaisVendidos(e){return await this.fetchData(`dashboard/produtos/mais-vendidos?periodo=${e}`)}async getAlertas(){return await this.fetchData("dashboard/alertas")}async getMetricasOperacionais(){return await this.fetchData("dashboard/metricas-operacionais")}async getPrevisaoVendas(){try{const e=await fetch(`${this.baseUrl}/previsao-vendas`);if(!e.ok)throw new Error("Erro ao buscar previsão de vendas");return await e.json()}catch(e){return console.error("Erro ao buscar previsão de vendas:",e),this.getMockPrevisaoVendas()}}async getTendencias(){try{const e=await fetch(`${this.baseUrl}/tendencias`);if(!e.ok)throw new Error("Erro ao buscar tendências");return await e.json()}catch(e){return console.error("Erro ao buscar tendências:",e),this.getMockTendencias()}}async getRecomendacoesEstoque(){try{const e=await fetch(`${this.baseUrl}/recomendacoes-estoque`);if(!e.ok)throw new Error("Erro ao buscar recomendações de estoque");return await e.json()}catch(e){return console.error("Erro ao buscar recomendações de estoque:",e),this.getMockRecomendacoesEstoque()}}async getOtimizacaoPrecos(){try{const e=await fetch(`${this.baseUrl}/otimizacao-precos`);if(!e.ok)throw new Error("Erro ao buscar otimização de preços");return await e.json()}catch(e){return console.error("Erro ao buscar otimização de preços:",e),this.getMockOtimizacaoPrecos()}}getMockPrevisaoVendas(){return{labels:["Jan","Fev","Mar","Abr","Mai","Jun"],vendasReais:[15e3,18e3,22e3,19e3,25e3,28e3],previsao:[null,null,null,21e3,24e3,27e3]}}getMockTendencias(){return[{tipo:"crescimento",titulo:"Crescimento de Vendas",descricao:"Tendência de crescimento nas vendas do setor de eletrônicos",impacto:15,confianca:85},{tipo:"sazonalidade",titulo:"Sazonalidade Detecteda",descricao:"Pico de vendas previsto para o próximo trimestre",impacto:25,confianca:90},{tipo:"comportamento",titulo:"Mudança no Comportamento",descricao:"Aumento na preferência por produtos premium",impacto:10,confianca:75}]}getMockRecomendacoesEstoque(){return[{id:"1",produto:"Smartphone XYZ",descricao:"Estoque abaixo do nível recomendado",estoqueAtual:15,estoqueRecomendado:30,prioridade:"alta"},{id:"2",produto:"Notebook ABC",descricao:"Estoque próximo do ponto de reordem",estoqueAtual:25,estoqueRecomendado:40,prioridade:"media"}]}getMockOtimizacaoPrecos(){return[{id:"1",produto:"Smartphone XYZ",precoAtual:1999.99,precoRecomendado:1899.99,variacao:-5,elasticidade:-1.2,margemAtual:25,margemProjetada:23},{id:"2",produto:"Notebook ABC",precoAtual:4999.99,precoRecomendado:5299.99,variacao:6,elasticidade:-.8,margemAtual:30,margemProjetada:32}]}clearCache(){this.cache.clear()}};new class{constructor(){this.charts=new Map,this.currentPeriod="hoje",this.init()}async init(){this.setupEventListeners(),await this.loadData(),this.setupRefreshInterval()}setupEventListeners(){const e=document.getElementById("periodo");e&&e.addEventListener("change",e=>{this.currentPeriod=e.target.value,this.toggleDateInputs("personalizado"===e.target.value),this.loadData()});const t=document.getElementById("dataInicio"),a=document.getElementById("dataFim");t&&a&&[t,a].forEach(e=>{e.addEventListener("change",()=>this.loadData())});const o=document.querySelector('button[onclick="exportarRelatorio()"]');o&&o.addEventListener("click",()=>this.exportarRelatorio());const r=document.querySelector('button[onclick="imprimirRelatorio()"]');r&&r.addEventListener("click",()=>this.imprimirRelatorio())}toggleDateInputs(e){const t=document.querySelector(".filtro-data");t&&(t.style.display=e?"flex":"none")}async loadData(){try{const[e,t,o,r,s,n]=await Promise.all([a.getKPIs(),a.getVendasPorCategoria(this.currentPeriod),a.getVendasPorPeriodo(this.currentPeriod),a.getProdutosMaisVendidos(this.currentPeriod),a.getAlertas(),a.getMetricasOperacionais()]);this.updateKPIs(e),this.updateVendasCategoriaChart(t),this.updateVendasPeriodoChart(o),this.updateProdutosVendidosTable(r),this.updateAlertas(s),this.updateMetricasOperacionais(n)}catch(e){t.error("Erro ao carregar dados do dashboard"),console.error("Erro ao carregar dados:",e)}}updateKPIs(e){if(!e)return;const t={vendasHoje:document.getElementById("vendasHoje"),ticketMedio:document.getElementById("ticketMedio"),taxaOcupacao:document.getElementById("taxaOcupacao"),produtosBaixoEstoque:document.getElementById("produtosBaixoEstoque")};Object.entries(t).forEach(([t,a])=>{a&&e[t]&&(a.textContent=this.formatValue(t,e[t]))})}formatValue(e,t){switch(e){case"vendasHoje":case"ticketMedio":return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t);case"taxaOcupacao":return`${t}%`;default:return t}}updateVendasCategoriaChart(e){if(!e)return;const t=document.getElementById("graficoVendasCategoria");if(!t)return;this.charts.has("vendasCategoria")&&this.charts.get("vendasCategoria").destroy();const a=new Chart(t,{type:"doughnut",data:{labels:e.labels,datasets:[{data:e.values,backgroundColor:["#4CAF50","#2196F3","#FFC107","#9C27B0","#FF5722"]}]},options:{responsive:!0,plugins:{legend:{position:"right"},tooltip:{callbacks:{label:e=>{const t=e.raw,a=(t/e.dataset.data.reduce((e,t)=>e+t,0)*100).toFixed(1);return`${e.label}: ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)} (${a}%)`}}}}}});this.charts.set("vendasCategoria",a)}updateVendasPeriodoChart(e){if(!e)return;const t=document.getElementById("graficoVendasPeriodo");if(!t)return;this.charts.has("vendasPeriodo")&&this.charts.get("vendasPeriodo").destroy();const a=new Chart(t,{type:"line",data:{labels:e.labels,datasets:[{label:"Vendas",data:e.values,borderColor:"#2196F3",tension:.4,fill:!0,backgroundColor:"rgba(33, 150, 243, 0.1)"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.raw)}}},scales:{y:{beginAtZero:!0,ticks:{callback:e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumSignificantDigits:3}).format(e)}}}}});this.charts.set("vendasPeriodo",a)}updateProdutosVendidosTable(e){if(!e)return;const t=document.getElementById("corpoTabelaProdutos");t&&(t.innerHTML=e.map(e=>`\n            <tr>\n                <td>${e.nome}</td>\n                <td>${e.quantidade}</td>\n                <td>${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e.valorTotal)}</td>\n                <td>\n                    <span class="trend ${e.variacao>=0?"positive":"negative"}">\n                        <i class="fas fa-arrow-${e.variacao>=0?"up":"down"}"></i>\n                        ${Math.abs(e.variacao)}%\n                    </span>\n                </td>\n            </tr>\n        `).join(""))}updateAlertas(e){if(!e)return;const t=document.getElementById("alertasContainer");t&&(t.innerHTML=e.map(e=>`\n            <div class="alerta ${e.tipo}">\n                <i class="fas ${this.getAlertaIcon(e.tipo)}"></i>\n                <div class="alerta-conteudo">\n                    <h4>${e.titulo}</h4>\n                    <p>${e.mensagem}</p>\n                </div>\n                ${e.acao?`\n                    <button class="btn-alerta" onclick="${e.acao.funcao}">\n                        ${e.acao.texto}\n                    </button>\n                `:""}\n            </div>\n        `).join(""))}getAlertaIcon(e){return{estoque:"fa-box",venda:"fa-chart-line",financeiro:"fa-dollar-sign",sistema:"fa-cog"}[e]||"fa-bell"}updateMetricasOperacionais(e){}setupRefreshInterval(){setInterval(()=>this.loadData(),3e5)}async exportarRelatorio(){var e,a;try{const o=await fetch(`${CONFIG.API_URL}/dashboard/exportar`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({periodo:this.currentPeriod,dataInicio:null==(e=document.getElementById("dataInicio"))?void 0:e.value,dataFim:null==(a=document.getElementById("dataFim"))?void 0:a.value})});if(!o.ok)throw new Error("Erro ao exportar relatório");const r=await o.blob(),s=window.URL.createObjectURL(r),n=document.createElement("a");n.href=s,n.download=`relatorio-dashboard-${(new Date).toISOString().split("T")[0]}.xlsx`,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(s),t.success("Relatório exportado com sucesso")}catch(o){t.error("Erro ao exportar relatório"),console.error("Erro ao exportar:",o)}}imprimirRelatorio(){window.print()}};export{a as d};
